<div class="stock-bar-page">
  <div class="page-header">
    <h1 class="title">Stock Bar</h1>
    <p class="subtitle">G√©rez vos stocks par cat√©gorie</p>
  </div>

  <div class="metrics-grid">
    <div class="metric-card">
      <div class="content">
        <p class="heading">Produits Bar</p>
        <p class="title value-info">{{ stockMetrics.totalProducts }}</p>
        <p class="subtitle">{{ stockMetrics.categories }} cat√©gories</p>
      </div>
      <span class="icon-container accent">
        <span class="emoji">üì¶</span>
      </span>
    </div>

    <div class="metric-card critical">
      <div class="content critical">
        <p class="heading">Stock Critique</p>
        <p class="title value-danger">{{ stockMetrics.criticalStock }}</p>
        <p class="subtitle">√Ä r√©approvisionner</p>
      </div>
      <span class="icon-container danger">
        <span class="emoji">‚ö†Ô∏è</span>
      </span>
    </div>

    <div class="metric-card">
      <div class="content">
        <p class="heading">Valeur Stock</p>
        <p class="title value-success">{{ stockMetrics.stockValue | number:'1.0-0' }} FCFA</p>
        <p class="subtitle">&nbsp;</p>
      </div>
      <span class="icon-container success">
        <span class="emoji">üíé</span>
      </span>
    </div>

    <div class="metric-card">
      <div class="content">
        <p class="heading">Derni√®re MAJ</p>
        <p class="title">{{ getCurrentTime() }}</p>
        <p class="subtitle">Aujourd'hui</p>
      </div>
      <span class="icon-container grey">
        <span class="emoji">üïí</span>
      </span>
    </div>
  </div>

  @if (isLoading) {
    <div class="loader-overlay">
      <div class="loader"></div>
    </div>
  } @else {
    <div class="stock-table-container">
      <div class="table-controls">
        <input 
          type="text" 
          placeholder="Rechercher un produit..." 
          class="search-bar" 
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
        >

        <select 
          class="filter-select"
          [(ngModel)]="selectedCategory"
          (change)="applyFilters()"
        >
          <option value="all">Toutes les cat√©gories</option>
          @for (cat of categories; track cat.id) {
            <option [value]="cat.name">{{ cat.name }}</option>
          }
        </select>
        
        <label class="filter-checkbox-container">
          En rupture de stock
          <input 
            type="checkbox"
            [(ngModel)]="showOutOfStock"
            (change)="applyFilters()"
          >
          <span class="checkmark"></span>
        </label>
      </div>

      <table class="products-table">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Cat√©gorie</th>
            <th>Prix</th>
            <th>Stock</th>
            <th>Statut en stock</th>
          </tr>
        </thead>
        <tbody>
          @for (product of paginatedProducts; track product.id) {
            <tr>
              <td>{{ product.name }}</td>
              <td>{{ product.category }}</td>
              <td>{{ product.price | number:'1.0-0' }} FCFA</td>
              <td>{{ product.stock_quantity }}</td>
              <td class="status-cell" [class]="getStockStatusClass(product)">
                <span>{{ getStockStatus(product) }}</span>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" class="empty-state-cell">
                <div class="empty-state">
                  <span class="emoji">ü§∑</span>
                  <p>Aucun produit ne correspond √† vos filtres.</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      @if (totalPages > 1) {
        <div class="pagination">
          <button 
            class="page-link" 
            [disabled]="currentPage === 1" 
            (click)="onPageChange(currentPage - 1)">
            Pr√©c√©dent
          </button>
          @for (page of [].constructor(totalPages); track $index) {
            <button 
              class="page-link" 
              [class.active]="currentPage === $index + 1" 
              (click)="onPageChange($index + 1)">
              {{ $index + 1 }}
            </button>
          }
          <button 
            class="page-link" 
            [disabled]="currentPage === totalPages" 
            (click)="onPageChange(currentPage + 1)">
            Suivant
          </button>
        </div>
      }
    </div>
  }
</div>